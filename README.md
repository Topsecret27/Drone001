# Drone001
## การสร้างโดรนขนาด 4 ใบพัด
โครงการนี้จะลงลึกไปทางฮาร์ดแวร์ (Hardware) หรือวัสดุในการสร้างตัวโดรน มีการอธิบายส่วนประกอบต่าง ๆ และหลักการทำงาน สำหรับผู้ที่มีโค้ดการทำงานอยู่แล้ว
### โดรน (Drone) คืออะไร ?
โดรน หรืออากาศยานไร้คนขับ แต่เดิมทีเป็นหุ่นยนต์ปฏิบัติการทางทหาร ที่ใช้สอดแนมและบางสถานการณ์ถูกใช้สำหรับติดขีปนาวุธเพื่อโจมตีศัตรู ผ่านการควบคุมทางระยะไกล ในปัจจุบัน โดรนถูกนำมาใช้ทำประโยชน์ในด้านต่างๆ มากมาย เช่น

* การถ่ายภาพมุมสูง

* การขนส่งสินค้าระยะใกล้

* การเกษตร

* การช่วยชีวิตผู้ประสบภัยในพื้นที่ที่เข้าถึงยาก

### การทำงานของโดรน
การที่โดรนจะทำงานได้ ต้องประกอบด้วยเทคโนโลยีที่สำคัญ 4 ส่วนดังนี้

1. อากาศยานไร้คนขับ หรือ Unmanned Aerial Vehicles (UAV) เครื่องบินที่ไม่มีนักบิน UAV หรือโดรน มักใช้เรียกแทนกัน ซึ่ง UAV สามารถขับเคลื่อนได้เป็นอิสระ โดยจะถูกควบคุมโดยนักบินจากระยะไกล 

2. สถานีควบคุมภาคพื้นดิน หรือ Ground Control Station (GCS) เป็นหน่วยควบคุมกลางที่ทำให้โดรนบินได้ตามจุดประสงค์ต่างๆ สถานีการควบคุมภาคพื้นดินอาจประกอบด้วยจอมอนิเตอร์หลายๆ จอ หรือจากรีโมทคอนโทรลขนาดเล็กที่เป็นสัญญาณคลื่นวิทยุ

3. สัมภาระที่บรรทุกได้ หรือ Payloads ในปัจจุบัน โดรนมีการผลิตออกมาหลายรูปแบบ เพื่อให้สามารถนำอุปกรณ์ตรวจจับหรือสัมภาระต่างๆ ขึ้นไปตามวัตถุประสงค์ของการใช้งาน เช่น กล้องถ่ายภาพนิ่งหรือกล่องวีดิโอ กล้องอินฟราเรด เรดาร์ รวมถึงการติดตั้งจรวดหรือระเบิดขนาดต่างๆ ตามภารกิจ ซึ่งน้ำหนักบรรทุกได้ จะไม่เกิน 1/4 ถึง 1/3 ของน้ำหนักของตัวโดรน

4. ระบบเชื่อมโยงข้อมูล หรือ Data Links ทำหน้าที่เป็นศูนย์กลางการรับส่งสัญญาณ เพื่อสื่อสารกับผู้ควบคุมภาคพื้นดินขณะที่โดรนกำลังบิน โดยทั่วไปใช้เทคโนโลยีคลื่นความถี่วิทยุในการสื่อสาร Data Links สามารถเก็บข้อมูลที่สำคัญ เช่น เวลาบินที่เหลืออยู่ ระยะทางจากผู้ควบคุม ระยะทางจากเป้าหมาย ระดับความสูง เป็นต้น 

อ้างอิงจาก [เทคโนโลยีโดรน](https://www.ohesdc.org/post/%E0%B9%80%E0%B8%97%E0%B8%84%E0%B9%82%E0%B8%99%E0%B9%82%E0%B8%A5%E0%B8%A2%E0%B8%B5%E0%B9%82%E0%B8%94%E0%B8%A3%E0%B8%99)

### การกำหนดขอบเขตในการสร้างโดรน
การออกแบบโดรนขึ้นมาใช้งาน เราจำเป็นต้องคำนึงถึงวัตถุประสงค์ของการใช้งาน ยกตัวอย่างเช่น อยากสร้างโดรนเพื่อติดกล้องถ่ายรูปมุมสูง ก็ต้องคำนึงถึงน้ำหนักของตัวกล้อง จึงจะสามารถกำหนดขนาดและน้ำหนักของโดรนได้ อีกทั้งการกำหนดขนาดของแบตเตอรี่ ถ้าโดรนมีแบตเตอรี่ที่ความจุเยอะ ก็จะมีเวลาบินที่นาน แต่ต้องยอมแลกกับน้ำหนักของแบตเตอรี่ที่เพิ่มมาด้วย จึงมีความสำคัญมากที่ผู้ออกแบบต้องนำมาคิด

### อุปกรณ์และส่วนประกอบของโดรน

1. Frame Drone
<br> ใช้รุ่น FPV F330 เป็นโครงพลาสติก ABS ที่มีความแข็งแรงในระดับมาตรฐานทั่วไปสำหรับโดรน


    <img src="https://m.media-amazon.com/images/I/61-eI3QPPjL._AC_SX425_.jpg" width="300"/>

2. DC BlushLess Motor
<br> ใช้รุ่น A2212 เพื่อให้ประกอบเข้ากับเฟรม F330 ได้ และขนาดความเร็วรอบให้ใช้ขั้นต่ำ 1200KV จำนาน 4 ตัว


    <img src="https://ae01.alicdn.com/kf/S8a2c9e0232c4436f8ae0de1fbdb74e15M.jpg" width="300"/>

3. ESC Speed control
<br> เป็นตัวขับ DC BlushLess Motor ให้ทำงาน ควบคุมความเร็วรอบโดยใช้สัญญาณ PWM จากไมโครคอนโทรลเลอร์ ในที่นี้ใช้ขนาดพิกัด 40A จำนวน 4 ชุด


    <img src="https://ae01.alicdn.com/kf/Hc151b571acab4eb98b316b2c49bc054du.jpg" width="300"/>

4. Battery
<br> ใช้เป็นแบตเตอรี่ชนิด LiPo ขนาด 3s แรงดัน 11.1V และความจุแบตเตอรี่แนะนำให้ใช้ขนาด 1800mAh ขึ้นไป จึงจะบินได้นานขึ้น แต่ต้องคำนึงเรื่องน้ำหนักด้วย

    <img src="https://img-va.myshopline.com/image/store/2000408386/1640672930478/7d686d625e5641e6be24c05d4ba923e1.jpeg?w=1000&h=1000" width="300"/>

5. STM32F108C8T6 Microcontroller
<br> เป็นบอร์ดไมโครคอนโทรลเลอร์ 32bit มีข้อดีคือ ประมวลผลเร็ว เหมาะสำหรับควบคุมการทำงานของโดรน

    <img src="https://fa.lnwfile.com/_/fa/_raw/2v/w8/4w.jpg" width="300"/>

6. MPU-6050 Gyroscope
<br> เป็นไจโรสโคป 6 แกน สามารถวัดความเร็วเชิงมุม 3 แกน และการเร่งความเร็ว 3 แกนได้แม่นยำ ใช้ตัวประมวลผลการเคลื่อนไหวแบบดิจิตอล (DMP) 

    <img src="https://5.imimg.com/data5/WH/XQ/GLADMIN-23108818/gy-521-mpu6050-accelerometer-and-gyroscope-sensor-500x500.png" width="300"/>

7. ใบพัด
<br> ใช้ขนาด 8 นิ้ว จำนวน 4 ใบพัด

    <img src="https://down-th.img.susercontent.com/file/48b9e11e5cd250e2eb128147b8dd9941" width="300"/>

### การออกแบบวงจร PCB
การที่จะออกแบบ PCB ได้เราจะต้องออกแบบวงจรให้เข้ากับโค้ดที่เราเขียนไว้ก่อนหน้านี้
<br> การออกแบบวงจรสามารถเข้าดูได้จาก >> [Schematic](https://drive.google.com/file/d/1wdhBXqxUxhjCHvZUvvHNxOVamZYPn8tW/view?usp=drive_link)

ทุกคนสามารถออกแบบ PCB ได้ตามเว็ปไซต์ด้านล่างนี้
<br> ลิ้ง >> [Easy EDA](https://easyeda.com/)

เมื่อออกแบบ PCB เสร็จสิ้น และตรวจสอบความถูกต้องของวงจรเรียบร้อยแล้ว ให้ดาวน์โหลดเป็น Gerber file ลงมาในคอมพิวเตอร์ ไฟล์จะเป็นรูปแบบไฟล์ Zip จากนั้นให้ไปที่เว็ปไซต์ [JLCPCB](https://jlcpcb.com/) เพื่อจะสร้างเป็นแผ่น PCB จริง เมื่อเข้ามาหน้าเว็ปไซ์แล้ว จะมีช่องที่เขียนว่า "Add gerber file" ให้นำไฟล์ Gerber ที่บันทึกไว้ก่อนหน้านี้มาวางได้เลย เมื่ออัพโหลดเสร็จสิ้นจะขึ้นเป็นหน้าตาของแผ่น PCB ที่เราออกแบบไว้ จากนั้นเราสามารถเปลี่ยนชนิดของ PCB ได้ แต่ในที่นี้ใช้เป็นชนิด FR-4 ซึ่งเป็นแผ่น 2 เลเยอร์ แล้วยังสามารถเลือกเป็นสีต่างๆ ที่ต้องการได้ แต่จะมีความหนาของแผ่น PCB ในที่นี้เลือกความหนาไว้ที่ 1.6mm เพื่อให้มีความแข็งแรง เมื่อเลือกเสร็จสิ้นแล้ว ให้เลือกการขนส่งสินค้า ในแถบด้านขวาล่าง แนะนำให้เลือกเป็น "Economical Global Direct Line" เพื่อให้ค่าจัดส่งถูกลง แต่มีระยะเวลาจัดส่งประมาณ 7-9 วัน เสร็จสิ้นแล้วกด "Save to cart" จากนั้นให้ใส่ข้อมูล ชื่อที่อยู่ เบอร์โทรศัพท์ให้ถูกต้อง เลือกรูปแบบการชำระเงิน และยืนยันออเดอร์ เสร็จสิ้นขั้นตอน จากนั้นรอ 9-12 วัน เมื่อแผ่น PCB มาถึง ให้เราประกอบลงอุปกรณ์ให้เรียนร้อย และตรวจสอบความถูกต้องก่อนจ่ายไฟเข้าบอร์ด

ตัวอย่างแผ่น PCB >> [Gerber file](https://drive.google.com/file/d/1rVaxm7_zVle_P_GNF3kI6zMYXvFKWtAF/view?usp=drive_link)

   <img src="https://i.pinimg.com/736x/e9/6c/7f/e96c7f9709690578e45c6de65e95e0bc.jpg" width="300"/>

   <img src="https://i.pinimg.com/736x/0c/71/2c/0c712cf1a9b2201280cd837534e7aacc.jpg" width="300"/>

### การอัพโหลดโค้ดลงบนบอร์ด STM32F103C8T6
STM32 เป็นชิปที่สร้างโดย STMicroelectronics ภายในใช้ CPU ARM Cortex - M3 ขนาด 32bit ซึ่งออกแบบมาเพื่อไมโครคอนโทรลเลอร์โดยเฉพาะ

<br> ข้อมูลเกี่ยวกับบอร์ด STM32F103C8T6
* RAM 20 kB, ROM 64 kB
* รองรับการเชื่อมต่ออุปกรณ์ภายนอกผ่าน GPIO จำนวน 37 ช่อง, ADC จำนวน 10 ช่อง, UART จำนวน 3 ช่อง, I2C จำนวน 2 ช่อง, SPI จำนวน 2 ช่อง, CAN bus และ USB อย่างละ 1 ช่อง
* มี Timer ให้ใช้งานจำนวน 3 ตัว รองรับการสร้างสัญญาณ PWM ได้สูงสุด 4 ช่อง
* มี Watchdog Timers จำนวน 2 ตัว 
* มี DMA จำนวน 7 ช่อง รองรับ Timer, SPI, I2C, ADC, UART
* รองรับการเขียนโปรแกรมด้วย Arduino IDE, STM32CubeIDE, ARM Keil + STM32CubeMX
* อัพโหลดโปรแกรมผ่าน ST-Link V2 หรือผ่าน USB (กรณีลง Bootloader)
* มีจุดจั้มเปอร์ BOOT0 BOOT1 ใช้บังคับเข้าโหมดอัพโหลดโปรแกรม
* มีสวิตช์ Reset บนบอร์ด
* มีหลอดแอลอีดีโปรแกรมได้อิสระ (PC13) จำนวน 1 ดวง และไฟแสดงสถานะได้รับไฟเลี้ยงจำนวน 1 ดวง
* ใช้แรงดันไฟฟ้า 3.3V ในการทำงาน
* ขนาด 23 x 53 มิลลิเมตร

   <img src="https://fu.lnwfile.com/_/fu/_raw/bx/rj/lm.png" width="300"/>

ชิปของ STM32 แตกต่างจากชิปตะกูลอื่นๆ ตรงที่ไม่มี IDE และคอมไพล์เลอร์เป็นของตัวเอง การใช้งานต้องดาวน์โหลด IDE และคอมไพล์เลอร์จากบริษัทอื่นมาใช้ ตัวอย่าง IDE และคอมไพล์เลอร์ที่นิยมใช้งานกัน ได้แก่ IAR Embedded Workbench และ ARMmbed

<br> การอัพโหลดโค้ดลงบอร์ด STM32 จำเป็นจะต้องใช้เครื่องอัพโหลดที่ชื่อว่า ST-Link V2 หรือใช้การอัพโหลดผ่าน UART

   <img src="https://www.kroxne.com/4351-large_default/st-link-v2-stm8-stm32-upload-firmware-to-display-or-controller.jpg" width="300"/>
   
การอัพโหลดผ่าน ST-Link V2 สามารถต่อวงจรตามรูปด้านล่างนี้

   <img src="https://cz.lnwfile.com/_/cz/_raw/qb/py/oi.png" width="300"/>

อ้างอิงจาก [การใช้งาน STM32 ร่วมกับ Arduino เบื้องต้น](https://www.artronshop.co.th/article/43/%E0%B8%81%E0%B8%B2%E0%B8%A3%E0%B9%83%E0%B8%8A%E0%B9%89%E0%B8%87%E0%B8%B2%E0%B8%99-stm32-%E0%B8%A3%E0%B9%88%E0%B8%A7%E0%B8%A1%E0%B8%81%E0%B8%B1%E0%B8%9A-arduino-%E0%B9%80%E0%B8%9A%E0%B8%B7%E0%B9%89%E0%B8%AD%E0%B8%87%E0%B8%95%E0%B9%89%E0%B8%99)

<br> ภาพการทดสอบ MPU-6050 Gyroscope กับบอร์ด STM32 ด้วยโค้ด MPU-6050 with STM32

   <img src="https://i.pinimg.com/736x/ee/ab/52/eeab5291aa73e494b778c754d9d19e10.jpg" width="300"/>
